import{d as e,r as l,a as n,i as o,j as i,c as a,e as t,w as s,f as d,o as r,b as u,H as m,J as c,k as p,l as g,h,t as v,F as f,E as y,s as V,_ as b}from"./index-Lit_3WrB.js";const w={class:"member-settings-container"},_={class:"card-header"},R={class:"level-name-cell"},C={key:0},x={key:1},k={key:0},D={key:1},I={key:2},P={key:0},T={key:1},S={key:0},E={key:1},U={key:2},q={class:"action-buttons"},B=["src"],z=["src"],$={class:"dialog-footer"},j=b(e({__name:"MemberSettingsView",setup(e){const b=l(!1),j=l([{id:5,name:"普通用户",level:0,condition:"默认等级",minRechargeTotal:0,monthlyConsumption:0,minRecharge:0,discount:100,description:"所有用户的默认等级",icon:"https://element-plus.org/images/element-plus-logo.svg",introduction:"普通用户无特殊权益",isSystemDefault:!0},{id:2,name:"VIP1",level:1,condition:"累计充值满100元",minRechargeTotal:100,monthlyConsumption:100,minRecharge:100,discount:95,description:"储值用户享受95折优惠",icon:"https://element-plus.org/images/element-plus-logo.svg",introduction:"VIP1用户享受充值95折优惠"},{id:3,name:"VIP2",level:2,condition:"累计充值满1000元",minRechargeTotal:1e3,monthlyConsumption:500,minRecharge:1e3,discount:90,description:"稳定用户、活跃用户享受9折优惠",icon:"https://element-plus.org/images/element-plus-logo.svg",introduction:"VIP2用户享受充值9折优惠"},{id:4,name:"VIP3",level:3,condition:"累计充值满5000元",minRechargeTotal:5e3,monthlyConsumption:1e3,minRecharge:5e3,discount:85,description:"大客户，可定期回访与商务交流",icon:"https://element-plus.org/images/element-plus-logo.svg",introduction:"VIP3用户享受充值85折优惠及专属客服"},{id:1,name:"超级VIP",level:999,condition:"欢迎洽谈",minRechargeTotal:0,monthlyConsumption:0,minRecharge:0,discount:0,description:"特殊客户，经理可为每位超级VIP用户单独设置折扣",icon:"https://element-plus.org/images/element-plus-logo.svg",introduction:"超级VIP用户享受定制折扣优惠及最高级别服务",isCustomDiscount:!0,isEnabled:!0,isSystemDefault:!0}]),K=l(!1),M=l("add"),F=l(),G=n({id:0,name:"",icon:"",level:0,condition:"",minRechargeTotal:0,monthlyConsumption:0,minRecharge:0,discount:100,description:"",introduction:"",isCustomDiscount:!1,isEnabled:!0,isSystemDefault:!1}),J=n({name:[{required:!0,message:"请输入等级名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],icon:[{required:!0,message:"请上传等级图标",trigger:"change"}],minRechargeTotal:[{required:!0,message:"请输入累计充值升级条件",trigger:"blur"}],monthlyConsumption:[{required:!0,message:"请输入月消费升级条件",trigger:"blur"}],minRecharge:[{required:!0,message:"请输入最低充值金额",trigger:"blur"}],discount:[{required:!0,message:"请输入充值折扣",trigger:"blur"}],introduction:[{required:!0,message:"请输入会员介绍",trigger:"blur"}]});o((()=>j.value.map((e=>({...e})))));const H=e=>{if(999===e)return"danger";return["","success","warning","danger"][e]||""},N=()=>{M.value="add",G.id=0,G.name="",G.level=j.value.length>0?Math.max(...j.value.map((e=>e.level<100?e.level:0)))+1:1,G.condition="",G.minRechargeTotal=0,G.monthlyConsumption=0,G.minRecharge=0,G.discount=100,G.description="",G.introduction="",G.icon="",G.isCustomDiscount=!1,G.isEnabled=!0,G.isSystemDefault=!1,K.value=!0},A=async()=>{F.value&&await F.value.validate(((e,l)=>{if(e){if("add"===M.value&&(999===G.level||"超级VIP"===G.name))return void y.error("不允许新增超级会员");if(999===G.level||"超级VIP"===G.name?(G.level=999,G.name="超级VIP",G.condition="欢迎洽谈",G.minRechargeTotal=0,G.monthlyConsumption=0,G.minRecharge=0,G.isCustomDiscount=!0,G.isSystemDefault=!0,G.discount=0):G.condition=`累计充值满${G.minRechargeTotal}元`,"add"===M.value){if(j.value.find((e=>e.level===G.level)))return void y.error(`等级 ${G.level} 已存在，请选择其他等级`);const e=Math.max(...j.value.map((e=>e.id)),0)+1;j.value.push({id:e,name:G.name,level:G.level,condition:G.condition,minRechargeTotal:G.minRechargeTotal,monthlyConsumption:G.monthlyConsumption,minRecharge:G.minRecharge,discount:G.discount,description:G.description,introduction:G.introduction,icon:G.icon,isCustomDiscount:G.isCustomDiscount,isEnabled:G.isEnabled,isSystemDefault:G.isSystemDefault}),y.success("新增会员等级成功")}else{const e=j.value.findIndex((e=>e.id===G.id));-1!==e&&(j.value[e]={...j.value[e],name:G.name,condition:G.condition,minRechargeTotal:G.minRechargeTotal,monthlyConsumption:G.monthlyConsumption,minRecharge:G.minRecharge,discount:G.discount,description:G.description,introduction:G.introduction,icon:G.icon,isCustomDiscount:G.isCustomDiscount,isEnabled:G.isEnabled,isSystemDefault:G.isSystemDefault}),y.success("编辑会员等级成功")}K.value=!1}}))},L=e=>{G.icon=e.data.url},O=e=>{const l="image/jpeg"===e.type||"image/png"===e.type,n=e.size/1024<200;return l?!!n||(y.error("图标大小不能超过 200KB!"),!1):(y.error("图标只能是 JPG 或 PNG 格式!"),!1)};return i((()=>{})),(e,l)=>{const n=d("el-button"),o=d("el-table-column"),i=d("el-image"),Q=d("el-tag"),W=d("el-table"),X=d("el-card"),Y=d("el-input"),Z=d("el-form-item"),ee=d("Plus"),le=d("el-icon"),ne=d("el-upload"),oe=d("el-switch"),ie=d("el-input-number"),ae=d("el-form"),te=d("el-dialog"),se=c("loading");return r(),a("div",w,[t(X,{class:"box-card"},{header:s((()=>[u("div",_,[l[15]||(l[15]=u("span",null,"会员等级设置",-1)),t(n,{type:"primary",onClick:N},{default:s((()=>l[14]||(l[14]=[h("新增会员")]))),_:1})])])),default:s((()=>[l[19]||(l[19]=u("div",{class:"page-description"},[u("p",null,"管理会员等级和充值折扣设置，会员等级折扣仅适用于用户充值余额。用户累计充值金额达到设定条件时，系统将自动升级用户的会员等级。同时支持月消费系统（三月一核验），用户连续三个月达到月消费标准也可升级对应会员等级，与累充不对冲。")],-1)),m((r(),p(W,{data:j.value,style:{width:"100%"},border:"",stripe:""},{default:s((()=>[t(o,{type:"index",label:"序号",width:"60"}),t(o,{prop:"name",label:"等级名称","min-width":"120"},{default:s((e=>[u("div",R,[t(i,{src:e.row.icon,fit:"contain",style:{width:"24px",height:"24px","margin-right":"8px"}},null,8,["src"]),t(Q,{type:H(e.row.level)},{default:s((()=>[h(v(e.row.name),1)])),_:2},1032,["type"]),999!==e.row.level||e.row.isEnabled?g("",!0):(r(),p(Q,{key:0,type:"info",size:"small",effect:"plain",style:{"margin-left":"5px"}},{default:s((()=>l[16]||(l[16]=[h("已禁用")]))),_:1}))])])),_:1}),t(o,{prop:"level",label:"等级",width:"80"}),t(o,{prop:"condition",label:"累充升级条件","min-width":"150"},{default:s((e=>[999===e.row.level?(r(),a("span",C,"欢迎洽谈")):(r(),a("span",x,v(e.row.condition),1))])),_:1}),t(o,{prop:"monthlyConsumption",label:"月消费升级条件","min-width":"180"},{default:s((e=>[999===e.row.level?(r(),a("span",k,"欢迎洽谈")):e.row.monthlyConsumption>0?(r(),a("span",D,"连续三个月每月消费 "+v(e.row.monthlyConsumption)+"元",1)):(r(),a("span",I,"-"))])),_:1}),t(o,{prop:"minRecharge",label:"最低充值金额",width:"120"},{default:s((e=>[999===e.row.level?(r(),a("span",P,"欢迎洽谈")):(r(),a("span",T,v(e.row.minRecharge)+"元",1))])),_:1}),t(o,{prop:"discount",label:"充值折扣",width:"120"},{default:s((e=>[999===e.row.level?(r(),a("span",S,"欢迎洽谈")):(r(),a("span",E,v(e.row.discount)+"%",1)),e.row.isCustomDiscount&&999!==e.row.level?(r(),a("span",U,"(可调整)")):g("",!0)])),_:1}),t(o,{prop:"description",label:"备注","min-width":"200"}),t(o,{prop:"introduction",label:"会员介绍","min-width":"200"}),t(o,{label:"操作",width:"180",fixed:"right"},{default:s((e=>[u("div",q,[t(n,{size:"small",type:"primary",onClick:l=>{return n=e.row,M.value="edit",G.id=n.id,G.name=n.name,G.level=n.level,G.condition=n.condition,G.minRechargeTotal=n.minRechargeTotal,G.monthlyConsumption=n.monthlyConsumption,G.minRecharge=n.minRecharge,G.discount=n.discount,G.description=n.description,G.introduction=n.introduction,G.icon=n.icon,G.isCustomDiscount=n.isCustomDiscount,G.isEnabled=n.isEnabled,G.isSystemDefault=n.isSystemDefault,void(K.value=!0);var n}},{default:s((()=>l[17]||(l[17]=[h("编辑")]))),_:2},1032,["onClick"]),t(n,{size:"small",type:"danger",onClick:l=>{var n;0===(n=e.row).level||999===n.level||n.isSystemDefault?y.warning("系统默认等级不能删除"):V.confirm(`确定要删除会员等级"${n.name}"吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=j.value.findIndex((e=>e.id===n.id));-1!==e&&j.value.splice(e,1),y.success(`会员等级"${n.name}"已删除`)})).catch((()=>{y.info("已取消删除")}))},disabled:0===e.row.level||999===e.row.level||e.row.isSystemDefault},{default:s((()=>l[18]||(l[18]=[h("删除")]))),_:2},1032,["onClick","disabled"])])])),_:1})])),_:1},8,["data"])),[[se,b.value]]),l[20]||(l[20]=u("div",{class:"system-description"},[u("h3",null,"月消费系统说明（三月一核验）"),u("p",null,"1. 月消费系统与累计充值系统并行，两者不对冲，用户可通过任一方式达到升级条件。"),u("p",null,"2. 月消费系统要求用户连续三个月每月消费达到指定金额，系统每月1日进行核验。"),u("p",null,"3. 若用户某月消费未达标，连续计数将重置为0，需重新开始累计。"),u("p",null,"4. 用户达到月消费升级条件后，系统将自动升级用户会员等级。"),u("p",null,"5. 若用户当前等级已高于月消费可升级的等级，则不会降级。")],-1)),l[21]||(l[21]=u("div",{class:"system-description super-vip-description"},[u("h3",null,"超级VIP说明"),u("p",null,"1. 超级VIP为特殊会员等级，仅限经理手动指定用户。"),u("p",null,"2. 经理可在用户管理页面为每个超级VIP用户单独设置自定义折扣和充值折扣。"),u("p",null,"3. 超级VIP功能可在系统设置中开启或关闭，关闭状态下后台可选择用户为VIP1/2/3。"),u("p",null,"4. 超级VIP用户享受最高级别的服务和权益，包括专属客服、优先处理等特权。")],-1))])),_:1}),t(te,{modelValue:K.value,"onUpdate:modelValue":l[13]||(l[13]=e=>K.value=e),title:"add"===M.value?"新增会员等级":"编辑会员等级",width:"600px"},{footer:s((()=>[u("span",$,[t(n,{onClick:l[12]||(l[12]=e=>K.value=!1)},{default:s((()=>l[30]||(l[30]=[h("取消")]))),_:1}),t(n,{type:"primary",onClick:A},{default:s((()=>l[31]||(l[31]=[h("确定")]))),_:1})])])),default:s((()=>[t(ae,{model:G,"label-width":"100px",rules:J,ref_key:"levelFormRef",ref:F},{default:s((()=>[999===G.level||"超级VIP"===G.name?(r(),a(f,{key:0},[t(Z,{label:"等级名称",prop:"name"},{default:s((()=>[t(Y,{modelValue:G.name,"onUpdate:modelValue":l[0]||(l[0]=e=>G.name=e),placeholder:"请输入等级名称"},null,8,["modelValue"])])),_:1}),t(Z,{label:"等级图标",prop:"icon"},{default:s((()=>[t(ne,{class:"avatar-uploader",action:"/api/upload","show-file-list":!1,"on-success":L,"before-upload":O},{default:s((()=>[G.icon?(r(),a("img",{key:0,src:G.icon,class:"avatar"},null,8,B)):(r(),p(le,{key:1,class:"avatar-uploader-icon"},{default:s((()=>[t(ee)])),_:1}))])),_:1}),l[22]||(l[22]=u("div",{class:"form-tip"},"建议上传正方形图片，大小不超过200KB",-1))])),_:1}),t(Z,{label:"备注",prop:"description"},{default:s((()=>[t(Y,{modelValue:G.description,"onUpdate:modelValue":l[1]||(l[1]=e=>G.description=e),type:"textarea",rows:2,placeholder:"请输入备注说明"},null,8,["modelValue"])])),_:1}),t(Z,{label:"会员介绍",prop:"introduction"},{default:s((()=>[t(Y,{modelValue:G.introduction,"onUpdate:modelValue":l[2]||(l[2]=e=>G.introduction=e),type:"textarea",rows:3,placeholder:"请输入会员等级权益介绍"},null,8,["modelValue"])])),_:1}),t(Z,{label:"启用状态"},{default:s((()=>[t(oe,{modelValue:G.isEnabled,"onUpdate:modelValue":l[3]||(l[3]=e=>G.isEnabled=e)},null,8,["modelValue"]),l[23]||(l[23]=u("span",{class:"form-tip"},"关闭后，超级VIP功能将被禁用，后台可选择用户为VIP1/2/3",-1))])),_:1})],64)):(r(),a(f,{key:1},[t(Z,{label:"等级名称",prop:"name"},{default:s((()=>[t(Y,{modelValue:G.name,"onUpdate:modelValue":l[4]||(l[4]=e=>G.name=e),placeholder:"请输入等级名称"},null,8,["modelValue"])])),_:1}),t(Z,{label:"等级图标",prop:"icon"},{default:s((()=>[t(ne,{class:"avatar-uploader",action:"/api/upload","show-file-list":!1,"on-success":L,"before-upload":O},{default:s((()=>[G.icon?(r(),a("img",{key:0,src:G.icon,class:"avatar"},null,8,z)):(r(),p(le,{key:1,class:"avatar-uploader-icon"},{default:s((()=>[t(ee)])),_:1}))])),_:1}),l[24]||(l[24]=u("div",{class:"form-tip"},"建议上传正方形图片，大小不超过200KB",-1))])),_:1}),t(Z,{label:"等级",prop:"level"},{default:s((()=>[t(ie,{modelValue:G.level,"onUpdate:modelValue":l[5]||(l[5]=e=>G.level=e),min:1,max:10,disabled:!0,controls:!1},null,8,["modelValue"]),l[25]||(l[25]=u("span",{class:"form-tip"},"系统自动生成，无需填写",-1))])),_:1}),t(Z,{label:"累充升级条件",prop:"minRechargeTotal"},{default:s((()=>[t(ie,{modelValue:G.minRechargeTotal,"onUpdate:modelValue":l[6]||(l[6]=e=>G.minRechargeTotal=e),min:0,precision:0,step:100,style:{width:"180px"}},null,8,["modelValue"]),l[26]||(l[26]=u("span",{class:"form-tip"},"元（用户累计充值达到此金额时自动升级）",-1))])),_:1}),t(Z,{label:"月消费升级条件",prop:"monthlyConsumption"},{default:s((()=>[t(ie,{modelValue:G.monthlyConsumption,"onUpdate:modelValue":l[7]||(l[7]=e=>G.monthlyConsumption=e),min:0,precision:0,step:100,style:{width:"180px"}},null,8,["modelValue"]),l[27]||(l[27]=u("span",{class:"form-tip"},"元（用户连续三个月每月消费达到此金额时自动升级）",-1))])),_:1}),t(Z,{label:"最低充值金额",prop:"minRecharge"},{default:s((()=>[t(ie,{modelValue:G.minRecharge,"onUpdate:modelValue":l[8]||(l[8]=e=>G.minRecharge=e),min:0,precision:0,step:100,style:{width:"180px"}},null,8,["modelValue"]),l[28]||(l[28]=u("span",{class:"form-tip"},"元（用户单次最低充值金额）",-1))])),_:1}),t(Z,{label:"充值折扣",prop:"discount"},{default:s((()=>[t(ie,{modelValue:G.discount,"onUpdate:modelValue":l[9]||(l[9]=e=>G.discount=e),min:0,max:100,precision:1,step:.1,style:{width:"180px"}},null,8,["modelValue"]),l[29]||(l[29]=u("span",{class:"form-tip"},"%（百分比，例如：50表示5折，即0.5折）",-1))])),_:1}),t(Z,{label:"备注",prop:"description"},{default:s((()=>[t(Y,{modelValue:G.description,"onUpdate:modelValue":l[10]||(l[10]=e=>G.description=e),type:"textarea",rows:2,placeholder:"请输入备注说明"},null,8,["modelValue"])])),_:1}),t(Z,{label:"会员介绍",prop:"introduction"},{default:s((()=>[t(Y,{modelValue:G.introduction,"onUpdate:modelValue":l[11]||(l[11]=e=>G.introduction=e),type:"textarea",rows:3,placeholder:"请输入会员等级权益介绍"},null,8,["modelValue"])])),_:1})],64))])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-a06e6ba9"]]);export{j as default};
