import{d as e,r as l,a,i,j as n,c as d,e as t,w as o,f as s,o as r,b as u,G as c,H as p,k as m,h as v,t as g,l as h,E as f,s as w,_ as b}from"./index-DdCtHfSO.js";const _={class:"member-settings-container"},x={class:"card-header"},V={class:"action-buttons"},y={class:"recharge-preview",style:{"margin-top":"20px"}},R={class:"auto-upgrade-tip"},k={class:"recharge-examples"},C={class:"recharge-example-item"},U={class:"amount"},I={class:"recharge-example-item"},q={class:"amount"},F={class:"recharge-example-item"},z={class:"amount"},M={key:0,class:"upgrade-tip"},P={class:"dialog-footer"},j=b(e({__name:"MemberSettingsView",setup(e){const b=l(!1),j=l([{id:1,name:"普通用户",level:0,condition:"默认等级",minRecharge:0,discount:100,description:"所有用户的默认等级"},{id:2,name:"VIP1",level:1,condition:"累计充值满100元",minRecharge:100,discount:95,description:"储值用户享受95折优惠"},{id:3,name:"VIP2",level:2,condition:"累计充值满1000元",minRecharge:1e3,discount:90,description:"稳定用户、活跃用户享受9折优惠"},{id:4,name:"VIP3",level:3,condition:"累计充值满5000元",minRecharge:5e3,discount:85,description:"大客户，可定期回访与商务交流"}]),B=l(!1),T=l("add"),$=l(),E=a({id:0,name:"",level:0,condition:"",minRecharge:0,discount:100,description:""}),G=a({name:[{required:!0,message:"请输入等级名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],level:[{required:!0,message:"请输入等级",trigger:"blur"}],condition:[{required:!0,message:"请输入升级条件",trigger:"blur"}],minRecharge:[{required:!0,message:"请输入最低充值金额",trigger:"blur"}],discount:[{required:!0,message:"请输入充值折扣",trigger:"blur"}]}),H=i((()=>j.value.map((e=>({...e}))))),S=e=>["","success","warning","danger"][e]||"",A=()=>{T.value="add",E.id=0,E.name="",E.level=j.value.length>0?Math.max(...j.value.map((e=>e.level)))+1:1,E.condition="",E.minRecharge=0,E.discount=100,E.description="",B.value=!0},D=async()=>{$.value&&await $.value.validate(((e,l)=>{if(e){if("add"===T.value){const e=Math.max(...j.value.map((e=>e.id)),0)+1;j.value.push({id:e,name:E.name,level:E.level,condition:E.condition,minRecharge:E.minRecharge,discount:E.discount,description:E.description}),f.success("新增会员等级成功")}else{const e=j.value.findIndex((e=>e.id===E.id));-1!==e&&(j.value[e]={...j.value[e],name:E.name,condition:E.condition,minRecharge:E.minRecharge,discount:E.discount,description:E.description}),f.success("编辑会员等级成功")}B.value=!1}}))},J=e=>{const l=j.value.find((l=>l.level===e.level+1));return l?l.name:""},K=e=>{const l=j.value.find((l=>l.level===e.level+1));return l?l.minRecharge-e.minRecharge:0};return n((()=>{})),(e,l)=>{const a=s("el-button"),i=s("el-table-column"),n=s("el-tag"),L=s("el-table"),N=s("el-alert"),O=s("el-divider"),Q=s("el-card"),W=s("el-input"),X=s("el-form-item"),Y=s("el-input-number"),Z=s("el-form"),ee=s("el-dialog"),le=p("loading");return r(),d("div",_,[t(Q,{class:"box-card"},{header:o((()=>[u("div",x,[l[9]||(l[9]=u("span",null,"会员等级设置",-1)),t(a,{type:"primary",size:"small",onClick:A},{default:o((()=>l[8]||(l[8]=[v("新增等级")]))),_:1})])])),default:o((()=>[l[17]||(l[17]=u("div",{class:"page-description"},[u("p",null,"管理会员等级和充值折扣设置，会员等级折扣仅适用于用户充值余额。用户累计充值金额达到设定条件时，系统将自动升级用户的会员等级。")],-1)),c((r(),m(L,{data:j.value,style:{width:"100%"},border:"",stripe:""},{default:o((()=>[t(i,{type:"index",label:"序号",width:"60"}),t(i,{prop:"name",label:"等级名称","min-width":"120"},{default:o((e=>[t(n,{type:S(e.row.level)},{default:o((()=>[v(g(e.row.name),1)])),_:2},1032,["type"])])),_:1}),t(i,{prop:"level",label:"等级",width:"80"}),t(i,{prop:"condition",label:"升级条件","min-width":"180"}),t(i,{prop:"minRecharge",label:"最低充值金额",width:"120"},{default:o((e=>[u("span",null,g(e.row.minRecharge)+"元",1)])),_:1}),t(i,{prop:"discount",label:"充值折扣",width:"120"},{default:o((e=>[u("span",null,g(e.row.discount)+"%",1)])),_:1}),t(i,{prop:"description",label:"说明","min-width":"200"}),t(i,{label:"操作",width:"180",fixed:"right"},{default:o((e=>[u("div",V,[t(a,{size:"small",type:"primary",onClick:l=>{return a=e.row,T.value="edit",E.id=a.id,E.name=a.name,E.level=a.level,E.condition=a.condition,E.minRecharge=a.minRecharge,E.discount=a.discount,E.description=a.description,void(B.value=!0);var a}},{default:o((()=>l[10]||(l[10]=[v("编辑")]))),_:2},1032,["onClick"]),t(a,{size:"small",type:"danger",onClick:l=>{var a;0!==(a=e.row).level?w.confirm(`确定要删除会员等级"${a.name}"吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=j.value.findIndex((e=>e.id===a.id));-1!==e&&j.value.splice(e,1),f.success(`会员等级"${a.name}"已删除`)})).catch((()=>{f.info("已取消删除")})):f.warning("普通用户等级不能删除")},disabled:0===e.row.level},{default:o((()=>l[11]||(l[11]=[v("删除")]))),_:2},1032,["onClick","disabled"])])])),_:1})])),_:1},8,["data"])),[[le,b.value]]),u("div",y,[l[16]||(l[16]=u("h3",null,"充值折扣预览",-1)),u("div",R,[t(N,{title:"会员等级自动升级说明",type:"info",description:"系统会根据用户的累计充值金额自动调整会员等级。当用户累计充值金额达到或超过某一等级的最低充值金额要求时，系统将自动将用户升级到该等级。","show-icon":"",closable:!1})]),t(L,{data:H.value,style:{width:"100%","margin-top":"15px"},border:""},{default:o((()=>[t(i,{prop:"level",label:"会员等级",width:"120"},{default:o((e=>[t(n,{type:S(e.row.level)},{default:o((()=>[v(g(e.row.name),1)])),_:2},1032,["type"])])),_:1}),t(i,{prop:"discount",label:"折扣率",width:"100"},{default:o((e=>[u("span",null,g(e.row.discount)+"%",1)])),_:1}),t(i,{label:"充值示例","min-width":"400"},{default:o((e=>[u("div",k,[u("div",C,[l[12]||(l[12]=u("span",null,"充值100元，实际到账：",-1)),u("span",U,g((1e4/e.row.discount).toFixed(2))+"元",1)]),u("div",I,[l[13]||(l[13]=u("span",null,"充值500元，实际到账：",-1)),u("span",q,g((5e4/e.row.discount).toFixed(2))+"元",1)]),u("div",F,[l[14]||(l[14]=u("span",null,"充值1000元，实际到账：",-1)),u("span",z,g((1e5/e.row.discount).toFixed(2))+"元",1)]),e.row.level<3?(r(),d("div",M,[t(O,{"content-position":"left"},{default:o((()=>l[15]||(l[15]=[v("升级提示")]))),_:1}),u("span",null,"再累计充值 "+g(K(e.row))+" 元可升级到 "+g(J(e.row)),1)])):h("",!0)])])),_:1})])),_:1},8,["data"])])])),_:1}),t(ee,{modelValue:B.value,"onUpdate:modelValue":l[7]||(l[7]=e=>B.value=e),title:"add"===T.value?"新增会员等级":"编辑会员等级",width:"600px"},{footer:o((()=>[u("span",P,[t(a,{onClick:l[6]||(l[6]=e=>B.value=!1)},{default:o((()=>l[21]||(l[21]=[v("取消")]))),_:1}),t(a,{type:"primary",onClick:D},{default:o((()=>l[22]||(l[22]=[v("确定")]))),_:1})])])),default:o((()=>[t(Z,{model:E,"label-width":"100px",rules:G,ref_key:"levelFormRef",ref:$},{default:o((()=>[t(X,{label:"等级名称",prop:"name"},{default:o((()=>[t(W,{modelValue:E.name,"onUpdate:modelValue":l[0]||(l[0]=e=>E.name=e),placeholder:"请输入等级名称"},null,8,["modelValue"])])),_:1}),t(X,{label:"等级",prop:"level"},{default:o((()=>[t(Y,{modelValue:E.level,"onUpdate:modelValue":l[1]||(l[1]=e=>E.level=e),min:0,max:10,disabled:"edit"===T.value},null,8,["modelValue","disabled"]),l[18]||(l[18]=u("span",{class:"form-tip"},"0表示普通用户，数字越大等级越高",-1))])),_:1}),t(X,{label:"升级条件",prop:"condition"},{default:o((()=>[t(W,{modelValue:E.condition,"onUpdate:modelValue":l[2]||(l[2]=e=>E.condition=e),placeholder:"请输入升级条件"},null,8,["modelValue"])])),_:1}),t(X,{label:"最低充值金额",prop:"minRecharge"},{default:o((()=>[t(Y,{modelValue:E.minRecharge,"onUpdate:modelValue":l[3]||(l[3]=e=>E.minRecharge=e),min:0,precision:0,step:100,style:{width:"180px"}},null,8,["modelValue"]),l[19]||(l[19]=u("span",{class:"form-tip"},"元（用户累计充值达到此金额时自动升级）",-1))])),_:1}),t(X,{label:"充值折扣",prop:"discount"},{default:o((()=>[t(Y,{modelValue:E.discount,"onUpdate:modelValue":l[4]||(l[4]=e=>E.discount=e),min:0,max:100,precision:1,step:.1,style:{width:"180px"}},null,8,["modelValue"]),l[20]||(l[20]=u("span",{class:"form-tip"},"%（百分比，例如：95表示95折，即9.5折）",-1))])),_:1}),t(X,{label:"说明",prop:"description"},{default:o((()=>[t(W,{modelValue:E.description,"onUpdate:modelValue":l[5]||(l[5]=e=>E.description=e),type:"textarea",rows:3,placeholder:"请输入说明"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-ca3afd59"]]);export{j as default};
