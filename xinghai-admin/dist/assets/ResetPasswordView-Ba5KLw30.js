import{d as e,r as a,a as s,i as l,n as r,c as t,e as o,w as u,f as d,o as n,b as i,h as c,p,q as m,t as v,E as w,u as f,s as g,_ as h}from"./index-DdCtHfSO.js";const P={class:"reset-password-container"},_={class:"reset-password-content"},b={key:0,class:"step-content"},y={class:"captcha-container"},k=["src"],x={key:1,class:"step-content"},V={class:"password-strength"},C={class:"strength-meter"},T={class:"password-tips"},q={key:2,class:"step-content success-content"},B=h(e({__name:"ResetPasswordView",setup(e){const h=f(),B=a(),E=a(),I=a(0),U=a(!1),F=a(!1),R=a("https://picsum.photos/120/40?random="+Math.random()),z=s({currentPassword:"",captcha:""}),A=s({newPassword:"",confirmPassword:""}),M=s({currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"},{min:4,max:6,message:"长度在 4 到 6 个字符",trigger:"blur"}]}),S=s({newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:8,max:30,message:"长度在 8 到 30 个字符",trigger:"blur"},{validator:(e,a,s)=>{a===z.currentPassword?s(new Error("新密码不能与当前密码相同")):s()},trigger:"blur"},{validator:(e,a,s)=>{G.value<60?s(new Error("密码强度不足，请按照要求设置密码")):s()},trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(e,a,s)=>{a!==A.newPassword?s(new Error("两次输入密码不一致")):s()},trigger:"blur"}]}),Z=l((()=>A.newPassword.length>=8)),j=l((()=>/[a-z]/.test(A.newPassword))),K=l((()=>/[A-Z]/.test(A.newPassword))),L=l((()=>/[0-9]/.test(A.newPassword))),D=l((()=>/[^A-Za-z0-9]/.test(A.newPassword))),G=l((()=>{if(!A.newPassword)return 0;let e=0;return Z.value&&(e+=20),j.value&&(e+=20),K.value&&(e+=20),L.value&&(e+=20),D.value&&(e+=20),e})),H=l((()=>G.value<40?"weak":G.value<80?"medium":"strong")),J=l((()=>G.value<40?"弱":G.value<80?"中":"强")),N=()=>{R.value="https://picsum.photos/120/40?random="+Math.random()},O=async()=>{B.value&&await B.value.validate(((e,a)=>{e&&(U.value=!0,setTimeout((()=>{U.value=!1,"123456"===z.currentPassword?I.value=1:w.error("当前密码不正确")}),1e3))}))},Q=async()=>{E.value&&await E.value.validate(((e,a)=>{e&&(F.value=!0,setTimeout((()=>{F.value=!1,I.value=2}),1e3))}))},W=()=>{I.value=0},X=()=>{h.push("/user/profile")},Y=()=>{g.confirm("修改密码后需要重新登录，是否立即退出？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{localStorage.removeItem("token"),localStorage.removeItem("userInfo"),h.push("/login")})).catch((()=>{}))},$=()=>{g.confirm("确定要取消修改密码吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then((()=>{h.push("/user/profile")})).catch((()=>{}))};return r((()=>A.newPassword),(e=>{var a;A.confirmPassword&&(null==(a=E.value)||a.validateField("confirmPassword"))})),(e,a)=>{const s=d("el-step"),l=d("el-steps"),r=d("el-input"),w=d("el-form-item"),f=d("el-button"),g=d("el-form"),h=d("el-result"),ee=d("el-card");return n(),t("div",P,[o(ee,{class:"box-card"},{header:u((()=>a[4]||(a[4]=[i("div",{class:"card-header"},[i("span",null,"修改密码")],-1)]))),default:u((()=>[i("div",_,[o(l,{active:I.value,"finish-status":"success",simple:""},{default:u((()=>[o(s,{title:"验证身份",icon:"Lock"}),o(s,{title:"设置新密码",icon:"Key"}),o(s,{title:"完成",icon:"CircleCheck"})])),_:1},8,["active"]),0===I.value?(n(),t("div",b,[o(g,{model:z,rules:M,ref_key:"verifyFormRef",ref:B,"label-width":"100px",class:"verify-form"},{default:u((()=>[o(w,{label:"当前密码",prop:"currentPassword"},{default:u((()=>[o(r,{modelValue:z.currentPassword,"onUpdate:modelValue":a[0]||(a[0]=e=>z.currentPassword=e),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])])),_:1}),o(w,{label:"验证码",prop:"captcha"},{default:u((()=>[i("div",y,[o(r,{modelValue:z.captcha,"onUpdate:modelValue":a[1]||(a[1]=e=>z.captcha=e),placeholder:"请输入验证码"},null,8,["modelValue"]),i("div",{class:"captcha-image",onClick:N},[i("img",{src:R.value,alt:"验证码"},null,8,k)])])])),_:1}),o(w,null,{default:u((()=>[o(f,{type:"primary",onClick:O,loading:U.value},{default:u((()=>a[5]||(a[5]=[c("下一步")]))),_:1},8,["loading"]),o(f,{onClick:$},{default:u((()=>a[6]||(a[6]=[c("取消")]))),_:1})])),_:1})])),_:1},8,["model","rules"])])):1===I.value?(n(),t("div",x,[o(g,{model:A,rules:S,ref_key:"passwordFormRef",ref:E,"label-width":"100px",class:"password-form"},{default:u((()=>[o(w,{label:"新密码",prop:"newPassword"},{default:u((()=>[o(r,{modelValue:A.newPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>A.newPassword=e),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"]),i("div",V,[a[7]||(a[7]=i("div",{class:"strength-label"},"密码强度：",-1)),i("div",C,[i("div",{class:m(["strength-bar",H.value]),style:p({width:G.value+"%"})},null,6)]),i("div",{class:m(["strength-text",H.value])},v(J.value),3)]),i("div",T,[a[8]||(a[8]=i("p",null,"密码必须包含以下条件：",-1)),i("ul",null,[i("li",{class:m({active:Z.value})},"长度至少为8个字符",2),i("li",{class:m({active:j.value})},"包含小写字母",2),i("li",{class:m({active:K.value})},"包含大写字母",2),i("li",{class:m({active:L.value})},"包含数字",2),i("li",{class:m({active:D.value})},"包含特殊字符",2)])])])),_:1}),o(w,{label:"确认新密码",prop:"confirmPassword"},{default:u((()=>[o(r,{modelValue:A.confirmPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>A.confirmPassword=e),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])])),_:1}),o(w,null,{default:u((()=>[o(f,{type:"primary",onClick:Q,loading:F.value},{default:u((()=>a[9]||(a[9]=[c("提交")]))),_:1},8,["loading"]),o(f,{onClick:W},{default:u((()=>a[10]||(a[10]=[c("上一步")]))),_:1})])),_:1})])),_:1},8,["model","rules"])])):(n(),t("div",q,[o(h,{icon:"success",title:"密码修改成功","sub-title":"您的账户密码已经成功修改，请使用新密码登录系统"},{extra:u((()=>[o(f,{type:"primary",onClick:X},{default:u((()=>a[11]||(a[11]=[c("返回个人中心")]))),_:1}),o(f,{onClick:Y},{default:u((()=>a[12]||(a[12]=[c("重新登录")]))),_:1})])),_:1})]))])])),_:1})])}}}),[["__scopeId","data-v-d1fe8d08"]]);export{B as default};
